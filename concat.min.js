"undefined"===typeof L3D&&(L3D={init:function(){L3D.renderer=new L3D.Renderer;L3D.renderer.initGL();L3D.gl=L3D.renderer.getContext();L3D.matView=new L3D.Matrix4;L3D.matProj=new L3D.Matrix4;L3D.matWorld=new L3D.Matrix4}},L3D.F32Array=Float32Array,L3D.UI16Array=Uint16Array,L3D.toRadianConst=Math.PI/180,L3D.toDegreeConst=180/Math.PI,L3D.toRadian=function(a){return a*L3D.toRadianConst},L3D.toDegree=function(a){return a*L3D.toDegreeConst});function webGLStart(){L3D.init();L3D.renderer.start()}
L3D.Renderer=function(){function a(){requestAnimationFrame(a);c.viewport(0,0,c.viewportWidth,c.viewportHeight);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);L3D.matProj.perspective(45,c.viewportWidth/c.viewportHeight,0.1,2E4);L3D.matView.identity();L3D.matView.translate(-1.5,0,-7);g.render();L3D.matView.translate(3*Math.abs(((new Date).getTime()%4E3-2E3)/2E3),3,0);f.render();L3D.matView.identity();L3D.matView.translate(-1500,-1500,-5E3);for(var b=0;b<h.escena.length;b++)h.escena[b].render()}var b=
document.getElementById("canvas")||document.createElement("canvas"),c;this.initGL=function(){try{c=b.getContext("webgl")||b.getContext("experimental-webgl"),c.viewportWidth=b.width,c.viewportHeight=b.height}catch(a){}c||alert("No se Pudo Inicializar WebGL.")};this.getContext=function(){return c};this.start=function(){d=new L3D.ColorMaterial;g=new L3D.SubMesh(null,new L3D.BaseMaterial);e=new L3D.SubMesh(null,d);f=new L3D.SubMesh(new L3D.CubeGeometry(1,1,1),d);h=new L3D.ParserViewer;var b=[0,1,0,-1,
-1,0,1,-1,0],m=[0,1,2];g.geometry.vertices.updateData(b);g.geometry.indices.updateData(m);b=[1,1,0,-1,1,0,1,-1,0,-1,-1,0];m=[0,1,2,1,2,3];e.geometry.vertices.updateData(b);e.geometry.indices.updateData(m);c.clearColor(0,0,0,1);c.enable(c.DEPTH_TEST);requestAnimationFrame(a)};var d,g,e,f,h};
L3D.Geometry=function(){this.vertices=new L3D.F32Buffer;this.uvs=new L3D.F32Buffer;this.uvs2=new L3D.F32Buffer;this.normals=new L3D.F32Buffer;this.tangents=new L3D.F32Buffer;this.indices=new L3D.UI16Buffer;this.numIndices=this.numVertices=0};L3D.Geometry.prototype={dispose:function(){this.vertices.dispose();this.uvs.dispose();this.uvs2.dispose();this.normals.dispose();this.tangents.dispose();this.indices.dispose();this.numVertices=this.numIndices=0}};
L3D.GLBuffer=function(a,b,c){this.gl=L3D.gl;this.type=void 0!==a?a:this.gl.ARRAY_BUFFER;this.glbuffer=this.data=null;this.length=0;this.dirty=!0;this.usage=void 0!==b?b:this.gl.STATIC_DRAW;this.typeOfArray=void 0!==c?c:L3D.F32Array};
L3D.GLBuffer.prototype={updateData:function(a){a.length!=this.length?(this.data=new this.typeOfArray(a),this.length=a.length,this.invalidateBuffer()):this.data.set(a);this.dirty=!0},bindBuffer:function(){this.updateBuffer();this.gl.bindBuffer(this.type,this.glbuffer)},updateBuffer:function(){this.dirty&&(this.glbuffer||(this.glbuffer=this.gl.createBuffer()),this.gl.bindBuffer(this.type,this.glbuffer),this.gl.bufferData(this.type,this.data,this.usage),this.dirty=!1)},invalidateBuffer:function(){this.dirty=
!0;this.disposeBuffer()},dispose:function(){this.disposeBuffer();this.data=null;this.length=0},disposeBuffer:function(){this.glbuffer&&(this.gl.deleteBuffer(this.glbuffer),this.glbuffer=null)}};L3D.F32Buffer=function(){L3D.GLBuffer.call(this,L3D.gl.ARRAY_BUFFER,L3D.gl.STATIC_DRAW,L3D.F32Array)};L3D.F32Buffer.prototype=L3D.GLBuffer.prototype;L3D.UI16Buffer=function(){L3D.GLBuffer.call(this,L3D.gl.ELEMENT_ARRAY_BUFFER,L3D.gl.STATIC_DRAW,L3D.UI16Array)};L3D.UI16Buffer.prototype=L3D.GLBuffer.prototype;
L3D.SubMesh=function(a,b){this.geometry=void 0!=a?a:new L3D.Geometry;this.material=void 0!=b?b:new L3D.ColorMaterial(7798903);this.isInstance=!1};L3D.SubMesh.prototype={render:function(){this.material.render(this.geometry)},dispose:function(){this.isInstance||(this.geometry.dispose(),this.material=null)}};L3D.ByteArray=function(){this.buffer=null;this.position=0};
L3D.ByteArray.prototype={readFloat:function(){var a=(new Float32Array(this.buffer.slice(this.position,this.position+4),0,1))[0];this.position+=4;return a},readInt:function(){var a=new Uint8Array(this.buffer,this.position,4);this.position+=4;return a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24)},readUInt:function(){var a=new Uint8Array(this.buffer,this.position,4);this.position+=4;return a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24)},readByte:function(){var a=(new Int8Array(this.buffer,this.position,1))[0];this.position++;
return a},readBytes:function(a){var b=new Int8Array(this.buffer,this.position,a);this.position+=a;return b},readString:function(a){for(var b=new Uint8Array(this.buffer,this.position,a),c="",d=0;d<a&&0!=b[d];d++)c+=String.fromCharCode(b[d]);this.position+=a;return c}};
L3D.ParserViewer=function(){this.escena=[];this.filePath="lepton3d/assets/escena.dat";this.byteData=new L3D.ByteArray;this._version=0;this._vertices=[];this._normals=[];this._uvs=[];this._cantFaces=this._cantMeshes=this._cantTextures=this._color=0;this._texturesId=[];this._meshesId=[];this._meshes=[];this._faces=[];this._textures=[];this.load()};
L3D.ParserViewer.prototype={load:function(){var a=new XMLHttpRequest;a.open("GET",this.filePath,!0);a.responseType="arraybuffer";var b=this;a.onload=function(a){b.onload(a)};a.send(null)},onload:function(a){if(a=a.target.response)this.byteData.buffer=a,this.parse()},parse:function(){this.parseTextures();this.parseMeshes();this.parseFaces();this.parseSets();this.byteData.buffer=null;this.loadTextures();this.loadMeshes();this.build()},parseTextures:function(){var a=this.byteData;a.readString(10);this._version=
a.readInt();this.escena=[];this._cantTextures=a.readInt();this._texturesId=Array(this._cantTextures);for(var b=0;b<this._cantTextures;b++)a.readString(260).toLowerCase(),a.readInt()},parseMeshes:function(){var a=this.byteData;this._cantMeshes=a.readInt();this._meshesId=Array(this._cantMeshes);for(var b=0;b<this._cantMeshes;b++)a.readString(260)},parseFaces:function(){var a=this.byteData;this._cantFaces=a.readInt();this._faces=Array(this._cantFaces);for(var b=0;b<this._cantFaces;b++){var c={};c.tipo=
a.readByte();a.readBytes(3);for(var d=0;4>d;d++)this.parsePosition(),this.parseNormal(),this._color=a.readUInt(),this.parseUV();c.id=a.readInt();c.borde=a.readByte();a.readBytes(3);c.nroMesh=a.readInt();var g=a.readByte();a.readBytes(3);c.kd=a.readFloat();c.ks=a.readFloat();c.kr=a.readFloat();c.kt=a.readFloat();d=a.readInt();65535==d&&(d=-1);c.nroConjunto=d;if(-1!=c.nroMesh)for(c.cantLayers=a.readByte(),a.readBytes(3),c.matWorld=this.parseMatrix(),c.bmpK=a.readFloat(),c.texturaRotada=a.readByte(),
c.flagEspejar=a.readByte(),a.readBytes(2),c.flagMaterial=a.readInt(),c.layers=Array(c.cantLayers),d=0;d<c.cantLayers;d++){var e={};e.nroLayer=a.readByte();a.readBytes(3);e.material={};var f=e.material;f.diffuseColor=[a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat()];f.ambientColor=[a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat()];f.specularColor=[a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat()];f.emissiveColor=[a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat()];f.specularSharpness=
a.readFloat();a.readFloat();a.readFloat();var h=a.readByte(),k=a.readByte();a.readBytes(2);e.nroTextura=0<h&&255!=k?k:-1;e.material=f;if(e.nroLayer>=c.layers.length)throw Error("Nro de layer mayor a la cantidad de layers.");c.layers[e.nroLayer]=e}c.nroTextura=g;this._faces[b]=c}},parsePosition:function(){var a=this.byteData.readFloat(),b=this.byteData.readFloat(),c=this.byteData.readFloat();this._vertices.push(a);this._vertices.push(c);this._vertices.push(b)},parseNormal:function(){var a=this.byteData.readFloat(),
b=this.byteData.readFloat(),c=this.byteData.readFloat();this._normals.push(a);this._normals.push(c);this._normals.push(b)},parseUV:function(){this._uvs.push(this.byteData.readFloat());this._uvs.push(this.byteData.readFloat())},parseMatrix:function(){for(var a=new L3D.Matrix4,b=new Float32Array(16),c=0;16>c;c++)b[c]=this.byteData.readFloat();a.vec[0]=b[0];a.vec[1]=b[2];a.vec[2]=-b[1];a.vec[3]=b[3];a.vec[4]=b[8];a.vec[5]=b[10];a.vec[6]=-b[9];a.vec[7]=b[7];a.vec[8]=-b[4];a.vec[9]=-b[6];a.vec[10]=b[5];
a.vec[11]=b[11];a.vec[12]=b[12];a.vec[13]=b[14];a.vec[14]=-b[13];a.vec[15]=b[15];return a},parseSets:function(){var a=this.byteData,b=a.readInt();this._focusSets=Array(b);for(var c=0;c<b;c++){var d={};d.tipo=a.readByte();a.readBytes(3);var g=a.readFloat(),e=a.readFloat(),f=a.readFloat();d.vector=new L3D.Vector3(e,f,g);d.max=a.readFloat();var g=a.readFloat(),e=a.readFloat(),f=a.readFloat(),h=a.readFloat(),k=a.readFloat(),m=a.readFloat(),n=a.readFloat();d.offset=new L3D.Vector3(e,f,-g);d.dir=new L3D.Vector3(h,
0,-k);d.normal=new L3D.Vector3(m,0,-n);this._focusSets[c]=d}},loadTextures:function(){this._textures=Array(this._cantTextures)},loadMeshes:function(){0!=this._meshesId.Length&&(this._meshes=Array(this._cantMeshes))},build:function(){Array(1)[0]={};for(var a=[],b=new L3D.Vector3(999999,999999,999999),c=new L3D.Vector3(-999999,-999999,-999999),d=new L3D.Vector3,g=0,e=0;e<this._cantFaces;e++){var f=this._faces[e];if(-1!=f.nroMesh)this.resolveMesh(e);else{a.push(g+0);a.push(g+1);a.push(g+2);1==f.tipo&&
(a.push(g+0),a.push(g+2),a.push(g+3));for(var g=g+4,h=0;4>h;h++){var k=3*(4*e+h);d.set(this._vertices[k],this._vertices[k+1],this._vertices[k+2]);b.min(d);c.max(d)}if(e==this._cantFaces-1||f.id!=this._faces[e+1].id)f=new L3D.SubMesh(null,new L3D.ColorMaterial),h=a[0],k=a[a.length-1]+1,f.geometry.indices.updateData(a),f.geometry.vertices.updateData(this._vertices.slice(3*h,3*k)),f.geometry.normals.updateData(this._normals.slice(3*h,3*k)),f.geometry.uvs.updateData(this._uvs.slice(2*h,2*k)),this.escena.push(f)}}},
resolveMesh:function(a){},cloneTgcMesh:function(a){return null},getTexture:function(a){return null},downloadTexture:function(a){if(File.Exists(a))return!0;try{var b=new WebClient;Directory.CreateDirectory(Path.GetDirectoryName(a));var c=FocusParser.WEB_TEXTURE_FOLDER+a.Substring(FocusParser.TEXTURE_FOLDER.Length).Replace("\\","/").Replace(" ","%20").ToLower();b.DownloadFile(c,a);GuiController.Instance.Logger.log("Descargado: "+c);return!0}catch(d){return!1}}};
L3D.BaseMaterial=function(){this.gl=L3D.gl;this.program=this.vShader=this.fShader=null;this.uMatProjLocation=this.uMatViewLocation=this.uMatWorldLocation=this.tangentsLocation=this.normalsLocation=this.uvs2Location=this.uvsLocation=this.verticesLocation=-1;this.fScript="#ifdef GL_ES\nprecision highp float;\n#endif\nvoid main(void) {\ngl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}";this.vScript="attribute vec3 v_position;\nuniform mat4 uMatView;\nuniform mat4 uMatProj;\nvoid main(void) {\ngl_Position = uMatProj * uMatView * vec4(v_position, 1.0);\n}"};
L3D.BaseMaterial.prototype={render:function(a){var b=this.gl;this.bind();0<=this.verticesLocation&&(a.vertices.bindBuffer(),b.vertexAttribPointer(this.verticesLocation,3,b.FLOAT,!1,0,0));0<=this.uvsLocation&&(a.uvs.bindBuffer(),b.vertexAttribPointer(this.uvsLocation,2,b.FLOAT,!1,0,0));0<=this.uvs2Location&&(a.uvs2.bindBuffer(),b.vertexAttribPointer(this.uvs2Location,2,b.FLOAT,!1,0,0));0<=this.normalsLocation&&(a.normals.bindBuffer(),b.vertexAttribPointer(this.normalsLocation,3,b.FLOAT,!1,0,0));0<=
this.tangentsLocation&&(a.tangents.bindBuffer(),b.vertexAttribPointer(this.tangentsLocation,3,b.FLOAT,!1,0,0));this.uMatWorldLocation&&b.uniformMatrix4fv(this.uMatWorldLocation,!1,L3D.matWorld.vec);this.uMatViewLocation&&b.uniformMatrix4fv(this.uMatViewLocation,!1,L3D.matView.vec);this.uMatProjLocation&&b.uniformMatrix4fv(this.uMatProjLocation,!1,L3D.matProj.vec);this.bindExtended();a.indices.bindBuffer();b.drawElements(b.TRIANGLES,a.indices.length/3,b.UNSIGNED_SHORT,0)},bind:function(){this.build();
this.gl.useProgram(this.program)},bindExtended:function(){},build:function(){if(!this.program){var a=this.gl;this.vShader=this.buildShader(this.vScript,a.VERTEX_SHADER);this.fShader=this.buildShader(this.fScript,a.FRAGMENT_SHADER);this.program=a.createProgram();a.attachShader(this.program,this.vShader);a.attachShader(this.program,this.fShader);a.linkProgram(this.program);a.getProgramParameter(this.program,a.LINK_STATUS)||alert("No se pudieron inicializar los shaders");this.verticesLocation=this.getArrayLocation("v_position");
this.uvsLocation=this.getArrayLocation("v_uv");this.uvs2Location=this.getArrayLocation("v_uv2");this.normalsLocation=this.getArrayLocation("v_normal");this.tangentsLocation=this.getArrayLocation("v_tangent");this.uMatWorldLocation=this.getUniformLocation("uMatWorld");this.uMatViewLocation=this.getUniformLocation("uMatView");this.uMatProjLocation=this.getUniformLocation("uMatProj")}},getAttribLocation:function(a){return this.gl.getAttribLocation(this.program,a)},getUniformLocation:function(a){return this.gl.getUniformLocation(this.program,
a)},getArrayLocation:function(a){a=this.getAttribLocation(a);0<=a&&this.gl.enableVertexAttribArray(a);return a},buildShader:function(a,b){if(!a)return null;var c=this.gl,d;if(b==c.FRAGMENT_SHADER)d=c.createShader(c.FRAGMENT_SHADER);else if(b==c.VERTEX_SHADER)d=c.createShader(c.VERTEX_SHADER);else return null;c.shaderSource(d,a);c.compileShader(d);return c.getShaderParameter(d,c.COMPILE_STATUS)?d:(alert(c.getShaderInfoLog(d)),null)},dispose:function(){null!=this.program&&(this.gl.deleteProgram(this.program),
this.gl.deleteShader(this.fShader),this.gl.deleteShader(this.vShader));this.vShader=this.fShader=this.program=null}};
L3D.ColorMaterial=function(a){L3D.BaseMaterial.call(this);this.uColorLocation=null;this.fcolor=new L3D.F32Array(3);this.setColor(void 0!=a?a:11202575);this.fScript="#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 uColor;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\nvoid main(void) {\nvec3 lpos = vec3(0.0,2500.0,1.0);\nvec3 N = normalize(vNormal);\nvec3 L = normalize(lpos-vPosition);\nfloat bright = clamp(dot(N,L),0.4,1.0);\ngl_FragColor = vec4(bright*uColor, 1.0);\n}";this.vScript=
"attribute vec3 v_position;\nattribute vec3 v_normal;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\nuniform mat4 uMatView;\nuniform mat4 uMatProj;\nvoid main(void) {\ngl_Position = uMatProj * uMatView *  vec4(v_position, 1.0);\nvPosition = (uMatView * vec4(v_position, 1.0)).xyz;\nvNormal = (uMatView * vec4(v_normal, 0.0)).xyz;\n}"};L3D.ColorMaterial.prototype=Object.create(L3D.BaseMaterial.prototype);
L3D.ColorMaterial.prototype.bindExtended=function(){this.uColorLocation||(this.uColorLocation=this.getUniformLocation("uColor"));this.gl.uniform3fv(this.uColorLocation,this.fcolor)};L3D.ColorMaterial.prototype.setColor=function(a){this.color=a;this.fcolor[0]=((a&16711680)>>16)/255;this.fcolor[1]=((a&65280)>>8)/255;this.fcolor[2]=((a&255)>>0)/255};
L3D.Matrix4=function(a,b,c,d,g,e,f,h,k,m,n,q,r,s,t,p){this.vec=new L3D.F32Array(16);this.set(void 0!==a?a:1,b||0,c||0,d||0,g||0,void 0!==e?e:1,f||0,h||0,k||0,m||0,void 0!==n?n:1,q||0,r||0,s||0,t||0,void 0!==p?p:1)};
L3D.Matrix4.prototype={set:function(a,b,c,d,g,e,f,h,k,m,n,q,r,s,t,p){var l=this.vec;l[0]=a;l[1]=b;l[2]=c;l[3]=d;l[4]=g;l[5]=e;l[6]=f;l[7]=h;l[8]=k;l[9]=m;l[10]=n;l[11]=q;l[12]=r;l[13]=s;l[14]=t;l[15]=p;return this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},perspective:function(a,b,c,d){a=1/Math.tan(a/2);var g=1/(c-d);return this.set(a/b,0,0,0,0,a,0,0,0,0,(d+c)*g,-1,0,0,2*d*c*g,0)},translate:function(a,b,c){var d=this.vec;d[12]=d[0]*a+d[4]*b+d[8]*c+d[12];d[13]=d[1]*a+d[5]*
b+d[9]*c+d[13];d[14]=d[2]*a+d[6]*b+d[10]*c+d[14];d[15]=d[3]*a+d[7]*b+d[11]*c+d[15]},scale:function(a,b,c){var d=this.vec;d[0]*=a;d[1]*=a;d[2]*=a;d[3]*=a;d[4]*=b;d[5]*=b;d[6]*=b;d[7]*=b;d[8]*=c;d[9]*=c;d[10]*=c;d[11]*=c;d[12]=d[12];d[13]=d[13];d[14]=d[14];d[15]=d[15]},copy:function(a){this.vec.set(a.vec)}};L3D.Ray=function(a,b){this.orig=void 0!==a?a:new L3D.Vector3;this.dir=void 0!==b?b:new L3D.Vector3};L3D.Ray.prototype={};L3D.Vector2=function(a,b){this.x=a||0;this.y=b||0};
L3D.Vector2.prototype={add:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(a){this.x-=a.x;this.y-=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){this.x/=a;this.y/=a;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSqrt:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},min:function(a){this.x>
a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this},copy:function(a){this.x=a.x;this.y=a.y;return this}};L3D.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
L3D.Vector3.prototype={add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideScalar:function(a){this.x/=a;this.y/=a;this.z/=a;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},cross:function(a){var b=this.x,c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y+this.z+this.z)},lengthSqrt:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divideScalar(this.length())},transformCoordinate:function(a){a=a.vec;var b=this.x,c=this.y,d=this.z;this.x=a[0]*b+a[1]*c+a[2]*d+a[3];this.y=a[4]*b+a[5]*c+a[6]*d+a[7];this.z=a[8]*b+a[9]*c+a[10]*d+a[11];return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);return this},max:function(a){this.x<a.x&&(this.x=a.x);
this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},set:function(a,b,c){this.x=a;this.y=b;this.z=c}};L3D.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=d||0};
L3D.Vector4.prototype={add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},multiplyScale:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScale:function(a){this.x/=a;this.y/=a;this.z/=a;this.w/=a;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},normalize:function(){return this.divideScale(this.length())},lengthSqrt:function(){return this.x*this.x+
this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);this.w>a.w&&(this.w=a.w);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);this.w<a.w&&(this.w=a.w);return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this}};
L3D.CubeGeometry=function(a,b,c){L3D.Geometry.call(this);this.width=a;this.height=b;this.depth=c;this.build()};L3D.CubeGeometry.prototype=Object.create(L3D.Geometry.prototype);
L3D.CubeGeometry.prototype.build=function(){var a=this.width/2,b=this.height/2,c=this.depth/2;this.vertices.updateData([-a,-b,-c,-a,-b,c,-a,b,-c,-a,b,c,a,-b,-c,a,-b,c,a,b,-c,a,b,c,-a,-b,-c,-a,-b,c,a,-b,-c,a,-b,c,-a,b,-c,-a,b,c,a,b,-c,a,b,c,-a,-b,-c,-a,b,-c,a,-b,-c,a,b,-c,-a,-b,c,-a,b,c,a,-b,c,a,b,c]);this.normals.updateData([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);this.indices.updateData([0,
2,1,1,2,3,4,5,6,5,7,6,8,9,10,9,11,10,12,14,13,13,14,15,16,18,17,17,18,19,20,21,22,21,23,22])};
"undefined"===typeof L3D&&(L3D={init:function(){L3D.renderer=new L3D.Renderer;L3D.renderer.initGL();L3D.gl=L3D.renderer.getContext();L3D.matView=new L3D.Matrix4;L3D.matProj=new L3D.Matrix4;L3D.matWorld=new L3D.Matrix4}},L3D.F32Array=Float32Array,L3D.UI16Array=Uint16Array,L3D.toRadianConst=Math.PI/180,L3D.toDegreeConst=180/Math.PI,L3D.toRadian=function(a){return a*L3D.toRadianConst},L3D.toDegree=function(a){return a*L3D.toDegreeConst});function webGLStart(){L3D.init();L3D.renderer.start()}
L3D.Renderer=function(){function a(){c.viewport(0,0,c.viewportWidth,c.viewportHeight);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);L3D.matProj.perspective(45,c.viewportWidth/c.viewportHeight,0.1,2E4);L3D.matView.identity();L3D.matView.translate(-1.5,0,-7);g.render();L3D.matView.translate(3*Math.abs(((new Date).getTime()%4E3-2E3)/2E3),3,0);f.render();L3D.matView.identity();L3D.matView.translate(-1500,-1500,-5E3);for(var b=0;b<h.escena.length;b++)h.escena[b].render();requestAnimationFrame(a)}var b=
document.getElementById("canvas")||document.createElement("canvas"),c;this.initGL=function(){try{c=b.getContext("webgl")||b.getContext("experimental-webgl"),c.viewportWidth=b.width,c.viewportHeight=b.height}catch(a){}c||alert("No se Pudo Inicializar WebGL.")};this.getContext=function(){return c};this.start=function(){d=new L3D.ColorMaterial;g=new L3D.SubMesh(null,new L3D.BaseMaterial);e=new L3D.SubMesh(null,d);f=new L3D.SubMesh(new L3D.CubeGeometry(1,1,1),d);h=new L3D.ParserViewer;var b=[0,1,0,-1,
-1,0,1,-1,0],m=[0,1,2];g.geometry.vertices.updateData(b);g.geometry.indices.updateData(m);b=[1,1,0,-1,1,0,1,-1,0,-1,-1,0];m=[0,1,2,1,2,3];e.geometry.vertices.updateData(b);e.geometry.indices.updateData(m);c.clearColor(0,0,0,1);c.enable(c.DEPTH_TEST);requestAnimationFrame(a)};var d,g,e,f,h};
L3D.Geometry=function(){this.vertices=new L3D.F32Buffer;this.uvs=new L3D.F32Buffer;this.uvs2=new L3D.F32Buffer;this.normals=new L3D.F32Buffer;this.tangents=new L3D.F32Buffer;this.indices=new L3D.UI16Buffer;this.numIndices=this.numVertices=0};L3D.Geometry.prototype={dispose:function(){this.vertices.dispose();this.uvs.dispose();this.uvs2.dispose();this.normals.dispose();this.tangents.dispose();this.indices.dispose();this.numVertices=this.numIndices=0}};
L3D.GLBuffer=function(a,b,c){this.gl=L3D.gl;this.type=void 0!==a?a:this.gl.ARRAY_BUFFER;this.glbuffer=this.data=null;this.length=0;this.dirty=!0;this.usage=void 0!==b?b:this.gl.STATIC_DRAW;this.typeOfArray=void 0!==c?c:L3D.F32Array};
L3D.GLBuffer.prototype={updateData:function(a){a.length!=this.length?(this.data=new this.typeOfArray(a),this.length=a.length,this.invalidateBuffer()):this.data.set(a);this.dirty=!0},bindBuffer:function(){this.updateBuffer();this.gl.bindBuffer(this.type,this.glbuffer)},updateBuffer:function(){this.dirty&&(this.glbuffer||(this.glbuffer=this.gl.createBuffer()),this.gl.bindBuffer(this.type,this.glbuffer),this.gl.bufferData(this.type,this.data,this.usage),this.dirty=!1)},invalidateBuffer:function(){this.dirty=
!0;this.disposeBuffer()},dispose:function(){this.disposeBuffer();this.data=null;this.length=0},disposeBuffer:function(){this.glbuffer&&(this.gl.deleteBuffer(this.glbuffer),this.glbuffer=null)}};L3D.F32Buffer=function(){L3D.GLBuffer.call(this,L3D.gl.ARRAY_BUFFER,L3D.gl.STATIC_DRAW,L3D.F32Array)};L3D.F32Buffer.prototype=L3D.GLBuffer.prototype;L3D.UI16Buffer=function(){L3D.GLBuffer.call(this,L3D.gl.ELEMENT_ARRAY_BUFFER,L3D.gl.STATIC_DRAW,L3D.UI16Array)};L3D.UI16Buffer.prototype=L3D.GLBuffer.prototype;
L3D.SubMesh=function(a,b){this.geometry=void 0!=a?a:new L3D.Geometry;this.material=void 0!=b?b:new L3D.ColorMaterial(7798903);this.isInstance=!1};L3D.SubMesh.prototype={render:function(){this.material.render(this.geometry)},dispose:function(){this.isInstance||(this.geometry.dispose(),this.material=null)}};L3D.ByteArray=function(){this.buffer=null;this.position=0};
L3D.ByteArray.prototype={readFloat:function(){var a=(new Float32Array(this.buffer.slice(this.position,this.position+4),0,1))[0];this.position+=4;return a},readInt:function(){var a=new Uint8Array(this.buffer,this.position,4);this.position+=4;return a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24)},readUInt:function(){var a=new Uint8Array(this.buffer,this.position,4);this.position+=4;return a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24)},readByte:function(){var a=(new Int8Array(this.buffer,this.position,1))[0];this.position++;
return a},readBytes:function(a){var b=new Int8Array(this.buffer,this.position,a);this.position+=a;return b},readString:function(a){for(var b=new Uint8Array(this.buffer,this.position,a),c="",d=0;d<a&&0!=b[d];d++)c+=String.fromCharCode(b[d]);this.position+=a;return c}};
L3D.ParserViewer=function(){this.escena=[];this.filePath="lepton3d/assets/escena.dat";this.byteData=new L3D.ByteArray;this._version=0;this._vertices=[];this._normals=[];this._uvs=[];this._cantFaces=this._cantMeshes=this._cantTextures=this._color=0;this._texturesId=[];this._meshesId=[];this._meshes=[];this._faces=[];this._textures=[];this.load()};
L3D.ParserViewer.prototype={load:function(){var a=new XMLHttpRequest;a.open("GET",this.filePath,!0);a.responseType="arraybuffer";var b=this;a.onload=function(a){b.onload(a)};a.send(null)},onload:function(a){if(a=a.target.response)this.byteData.buffer=a,this.parse()},parse:function(){this.parseTextures();this.parseMeshes();this.parseFaces();this.parseSets();this.byteData.buffer=null;this.loadTextures();this.loadMeshes();this.build()},parseTextures:function(){var a=this.byteData;a.readString(10);this._version=
a.readInt();this.escena=[];this._cantTextures=a.readInt();this._texturesId=Array(this._cantTextures);for(var b=0;b<this._cantTextures;b++)a.readString(260).toLowerCase(),a.readInt()},parseMeshes:function(){var a=this.byteData;this._cantMeshes=a.readInt();this._meshesId=Array(this._cantMeshes);for(var b=0;b<this._cantMeshes;b++)a.readString(260)},parseFaces:function(){var a=this.byteData;this._cantFaces=a.readInt();this._faces=Array(this._cantFaces);for(var b=0;b<this._cantFaces;b++){var c={};c.tipo=
a.readByte();a.readBytes(3);for(var d=0;4>d;d++)this.parsePosition(),this.parseNormal(),this._color=a.readUInt(),this.parseUV();c.id=a.readInt();c.borde=a.readByte();a.readBytes(3);c.nroMesh=a.readInt();var g=a.readByte();a.readBytes(3);c.kd=a.readFloat();c.ks=a.readFloat();c.kr=a.readFloat();c.kt=a.readFloat();d=a.readInt();65535==d&&(d=-1);c.nroConjunto=d;if(-1!=c.nroMesh)for(c.cantLayers=a.readByte(),a.readBytes(3),c.matWorld=this.parseMatrix(),c.bmpK=a.readFloat(),c.texturaRotada=a.readByte(),
c.flagEspejar=a.readByte(),a.readBytes(2),c.flagMaterial=a.readInt(),c.layers=Array(c.cantLayers),d=0;d<c.cantLayers;d++){var e={};e.nroLayer=a.readByte();a.readBytes(3);e.material={};var f=e.material;f.diffuseColor=[a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat()];f.ambientColor=[a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat()];f.specularColor=[a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat()];f.emissiveColor=[a.readFloat(),a.readFloat(),a.readFloat(),a.readFloat()];f.specularSharpness=
a.readFloat();a.readFloat();a.readFloat();var h=a.readByte(),k=a.readByte();a.readBytes(2);e.nroTextura=0<h&&255!=k?k:-1;e.material=f;if(e.nroLayer>=c.layers.length)throw Error("Nro de layer mayor a la cantidad de layers.");c.layers[e.nroLayer]=e}c.nroTextura=g;this._faces[b]=c}},parsePosition:function(){var a=this.byteData.readFloat(),b=this.byteData.readFloat(),c=this.byteData.readFloat();this._vertices.push(a);this._vertices.push(c);this._vertices.push(b)},parseNormal:function(){var a=this.byteData.readFloat(),
b=this.byteData.readFloat(),c=this.byteData.readFloat();this._normals.push(a);this._normals.push(c);this._normals.push(b)},parseUV:function(){this._uvs.push(this.byteData.readFloat());this._uvs.push(this.byteData.readFloat())},parseMatrix:function(){for(var a=new L3D.Matrix4,b=new Float32Array(16),c=0;16>c;c++)b[c]=this.byteData.readFloat();a.vec[0]=b[0];a.vec[1]=b[2];a.vec[2]=-b[1];a.vec[3]=b[3];a.vec[4]=b[8];a.vec[5]=b[10];a.vec[6]=-b[9];a.vec[7]=b[7];a.vec[8]=-b[4];a.vec[9]=-b[6];a.vec[10]=b[5];
a.vec[11]=b[11];a.vec[12]=b[12];a.vec[13]=b[14];a.vec[14]=-b[13];a.vec[15]=b[15];return a},parseSets:function(){var a=this.byteData,b=a.readInt();this._focusSets=Array(b);for(var c=0;c<b;c++){var d={};d.tipo=a.readByte();a.readBytes(3);var g=a.readFloat(),e=a.readFloat(),f=a.readFloat();d.vector=new L3D.Vector3(e,f,g);d.max=a.readFloat();var g=a.readFloat(),e=a.readFloat(),f=a.readFloat(),h=a.readFloat(),k=a.readFloat(),m=a.readFloat(),n=a.readFloat();d.offset=new L3D.Vector3(e,f,-g);d.dir=new L3D.Vector3(h,
0,-k);d.normal=new L3D.Vector3(m,0,-n);this._focusSets[c]=d}},loadTextures:function(){this._textures=Array(this._cantTextures)},loadMeshes:function(){0!=this._meshesId.Length&&(this._meshes=Array(this._cantMeshes))},build:function(){Array(1)[0]={};for(var a=[],b=new L3D.Vector3(999999,999999,999999),c=new L3D.Vector3(-999999,-999999,-999999),d=new L3D.Vector3,g=0,e=0;e<this._cantFaces;e++){var f=this._faces[e];if(-1!=f.nroMesh)this.resolveMesh(e);else{a.push(g+0);a.push(g+1);a.push(g+2);1==f.tipo&&
(a.push(g+0),a.push(g+2),a.push(g+3));for(var g=g+4,h=0;4>h;h++){var k=3*(4*e+h);d.set(this._vertices[k],this._vertices[k+1],this._vertices[k+2]);b.min(d);c.max(d)}if(e==this._cantFaces-1||f.id!=this._faces[e+1].id)f=new L3D.SubMesh(null,new L3D.ColorMaterial),h=a[0],k=a[a.length-1]+1,f.geometry.indices.updateData(a),f.geometry.vertices.updateData(this._vertices.slice(3*h,3*k)),f.geometry.normals.updateData(this._normals.slice(3*h,3*k)),f.geometry.uvs.updateData(this._uvs.slice(2*h,2*k)),this.escena.push(f)}}},
resolveMesh:function(a){},cloneTgcMesh:function(a){return null},getTexture:function(a){return null},downloadTexture:function(a){if(File.Exists(a))return!0;try{var b=new WebClient;Directory.CreateDirectory(Path.GetDirectoryName(a));var c=FocusParser.WEB_TEXTURE_FOLDER+a.Substring(FocusParser.TEXTURE_FOLDER.Length).Replace("\\","/").Replace(" ","%20").ToLower();b.DownloadFile(c,a);GuiController.Instance.Logger.log("Descargado: "+c);return!0}catch(d){return!1}}};
L3D.BaseMaterial=function(){this.gl=L3D.gl;this.program=this.vShader=this.fShader=null;this.uMatProjLocation=this.uMatViewLocation=this.uMatWorldLocation=this.tangentsLocation=this.normalsLocation=this.uvs2Location=this.uvsLocation=this.verticesLocation=-1;this.fScript="#ifdef GL_ES\nprecision highp float;\n#endif\nvoid main(void) {\ngl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}";this.vScript="attribute vec3 v_position;\nuniform mat4 uMatView;\nuniform mat4 uMatProj;\nvoid main(void) {\ngl_Position = uMatProj * uMatView * vec4(v_position, 1.0);\n}"};
L3D.BaseMaterial.prototype={render:function(a){var b=this.gl;this.bind();0<=this.verticesLocation&&(a.vertices.bindBuffer(),b.vertexAttribPointer(this.verticesLocation,3,b.FLOAT,!1,0,0));0<=this.uvsLocation&&(a.uvs.bindBuffer(),b.vertexAttribPointer(this.uvsLocation,2,b.FLOAT,!1,0,0));0<=this.uvs2Location&&(a.uvs2.bindBuffer(),b.vertexAttribPointer(this.uvs2Location,2,b.FLOAT,!1,0,0));0<=this.normalsLocation&&(a.normals.bindBuffer(),b.vertexAttribPointer(this.normalsLocation,3,b.FLOAT,!1,0,0));0<=
this.tangentsLocation&&(a.tangents.bindBuffer(),b.vertexAttribPointer(this.tangentsLocation,3,b.FLOAT,!1,0,0));this.uMatWorldLocation&&b.uniformMatrix4fv(this.uMatWorldLocation,!1,L3D.matWorld.vec);this.uMatViewLocation&&b.uniformMatrix4fv(this.uMatViewLocation,!1,L3D.matView.vec);this.uMatProjLocation&&b.uniformMatrix4fv(this.uMatProjLocation,!1,L3D.matProj.vec);this.bindExtended();a.indices.bindBuffer();b.drawElements(b.TRIANGLES,a.indices.length/3,b.UNSIGNED_SHORT,0)},bind:function(){this.build();
this.gl.useProgram(this.program)},bindExtended:function(){},build:function(){if(!this.program){var a=this.gl;this.vShader=this.buildShader(this.vScript,a.VERTEX_SHADER);this.fShader=this.buildShader(this.fScript,a.FRAGMENT_SHADER);this.program=a.createProgram();a.attachShader(this.program,this.vShader);a.attachShader(this.program,this.fShader);a.linkProgram(this.program);a.getProgramParameter(this.program,a.LINK_STATUS)||alert("No se pudieron inicializar los shaders");this.verticesLocation=this.getArrayLocation("v_position");
this.uvsLocation=this.getArrayLocation("v_uv");this.uvs2Location=this.getArrayLocation("v_uv2");this.normalsLocation=this.getArrayLocation("v_normal");this.tangentsLocation=this.getArrayLocation("v_tangent");this.uMatWorldLocation=this.getUniformLocation("uMatWorld");this.uMatViewLocation=this.getUniformLocation("uMatView");this.uMatProjLocation=this.getUniformLocation("uMatProj")}},getAttribLocation:function(a){return this.gl.getAttribLocation(this.program,a)},getUniformLocation:function(a){return this.gl.getUniformLocation(this.program,
a)},getArrayLocation:function(a){a=this.getAttribLocation(a);0<=a&&this.gl.enableVertexAttribArray(a);return a},buildShader:function(a,b){if(!a)return null;var c=this.gl,d;if(b==c.FRAGMENT_SHADER)d=c.createShader(c.FRAGMENT_SHADER);else if(b==c.VERTEX_SHADER)d=c.createShader(c.VERTEX_SHADER);else return null;c.shaderSource(d,a);c.compileShader(d);return c.getShaderParameter(d,c.COMPILE_STATUS)?d:(alert(c.getShaderInfoLog(d)),null)},dispose:function(){null!=this.program&&(this.gl.deleteProgram(this.program),
this.gl.deleteShader(this.fShader),this.gl.deleteShader(this.vShader));this.vShader=this.fShader=this.program=null}};
L3D.ColorMaterial=function(a){L3D.BaseMaterial.call(this);this.uColorLocation=null;this.fcolor=new L3D.F32Array(3);this.setColor(void 0!=a?a:11202575);this.fScript="#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 uColor;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\nvoid main(void) {\nvec3 lpos = vec3(0.0,2500.0,1.0);\nvec3 N = normalize(vNormal);\nvec3 L = normalize(lpos-vPosition);\nfloat bright = clamp(dot(N,L),0.4,1.0);\ngl_FragColor = vec4(bright*uColor, 1.0);\n}";this.vScript=
"attribute vec3 v_position;\nattribute vec3 v_normal;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\nuniform mat4 uMatView;\nuniform mat4 uMatProj;\nvoid main(void) {\ngl_Position = uMatProj * uMatView *  vec4(v_position, 1.0);\nvPosition = (uMatView * vec4(v_position, 1.0)).xyz;\nvNormal = (uMatView * vec4(v_normal, 0.0)).xyz;\n}"};L3D.ColorMaterial.prototype=Object.create(L3D.BaseMaterial.prototype);
L3D.ColorMaterial.prototype.bindExtended=function(){this.uColorLocation||(this.uColorLocation=this.getUniformLocation("uColor"));this.gl.uniform3fv(this.uColorLocation,this.fcolor)};L3D.ColorMaterial.prototype.setColor=function(a){this.color=a;this.fcolor[0]=((a&16711680)>>16)/255;this.fcolor[1]=((a&65280)>>8)/255;this.fcolor[2]=((a&255)>>0)/255};
L3D.Matrix4=function(a,b,c,d,g,e,f,h,k,m,n,q,r,s,t,p){this.vec=new L3D.F32Array(16);this.set(void 0!==a?a:1,b||0,c||0,d||0,g||0,void 0!==e?e:1,f||0,h||0,k||0,m||0,void 0!==n?n:1,q||0,r||0,s||0,t||0,void 0!==p?p:1)};
L3D.Matrix4.prototype={set:function(a,b,c,d,g,e,f,h,k,m,n,q,r,s,t,p){var l=this.vec;l[0]=a;l[1]=b;l[2]=c;l[3]=d;l[4]=g;l[5]=e;l[6]=f;l[7]=h;l[8]=k;l[9]=m;l[10]=n;l[11]=q;l[12]=r;l[13]=s;l[14]=t;l[15]=p;return this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},perspective:function(a,b,c,d){a=1/Math.tan(a/2);var g=1/(c-d);return this.set(a/b,0,0,0,0,a,0,0,0,0,(d+c)*g,-1,0,0,2*d*c*g,0)},translate:function(a,b,c){var d=this.vec;d[12]=d[0]*a+d[4]*b+d[8]*c+d[12];d[13]=d[1]*a+d[5]*
b+d[9]*c+d[13];d[14]=d[2]*a+d[6]*b+d[10]*c+d[14];d[15]=d[3]*a+d[7]*b+d[11]*c+d[15]},scale:function(a,b,c){var d=this.vec;d[0]*=a;d[1]*=a;d[2]*=a;d[3]*=a;d[4]*=b;d[5]*=b;d[6]*=b;d[7]*=b;d[8]*=c;d[9]*=c;d[10]*=c;d[11]*=c;d[12]=d[12];d[13]=d[13];d[14]=d[14];d[15]=d[15]},copy:function(a){this.vec.set(a.vec)}};L3D.Ray=function(a,b){this.orig=void 0!==a?a:new L3D.Vector3;this.dir=void 0!==b?b:new L3D.Vector3};L3D.Ray.prototype={};L3D.Vector2=function(a,b){this.x=a||0;this.y=b||0};
L3D.Vector2.prototype={add:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(a){this.x-=a.x;this.y-=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){this.x/=a;this.y/=a;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSqrt:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},min:function(a){this.x>
a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this},copy:function(a){this.x=a.x;this.y=a.y;return this}};L3D.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
L3D.Vector3.prototype={add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideScalar:function(a){this.x/=a;this.y/=a;this.z/=a;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},cross:function(a){var b=this.x,c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y+this.z+this.z)},lengthSqrt:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divideScalar(this.length())},transformCoordinate:function(a){a=a.vec;var b=this.x,c=this.y,d=this.z;this.x=a[0]*b+a[1]*c+a[2]*d+a[3];this.y=a[4]*b+a[5]*c+a[6]*d+a[7];this.z=a[8]*b+a[9]*c+a[10]*d+a[11];return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);return this},max:function(a){this.x<a.x&&(this.x=a.x);
this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},set:function(a,b,c){this.x=a;this.y=b;this.z=c}};L3D.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=d||0};
L3D.Vector4.prototype={add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},multiplyScale:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScale:function(a){this.x/=a;this.y/=a;this.z/=a;this.w/=a;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},normalize:function(){return this.divideScale(this.length())},lengthSqrt:function(){return this.x*this.x+
this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);this.w>a.w&&(this.w=a.w);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);this.w<a.w&&(this.w=a.w);return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this}};
L3D.CubeGeometry=function(a,b,c){L3D.Geometry.call(this);this.width=a;this.height=b;this.depth=c;this.build()};L3D.CubeGeometry.prototype=Object.create(L3D.Geometry.prototype);
L3D.CubeGeometry.prototype.build=function(){var a=this.width/2,b=this.height/2,c=this.depth/2;this.vertices.updateData([-a,-b,-c,-a,-b,c,-a,b,-c,-a,b,c,a,-b,-c,a,-b,c,a,b,-c,a,b,c,-a,-b,-c,-a,-b,c,a,-b,-c,a,-b,c,-a,b,-c,-a,b,c,a,b,-c,a,b,c,-a,-b,-c,-a,b,-c,a,-b,-c,a,b,-c,-a,-b,c,-a,b,c,a,-b,c,a,b,c]);this.normals.updateData([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);this.indices.updateData([0,
2,1,1,2,3,4,5,6,5,7,6,8,9,10,9,11,10,12,14,13,13,14,15,16,18,17,17,18,19,20,21,22,21,23,22])};
